<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Halloween Haunted Terminal</title>
<style>
  html, body {
    margin: 0; padding: 0;
    overflow: hidden; height: 100%;
    background-color: black; color: red;
    font-family: "Courier New", monospace;
  }
  #matrixCanvas, #glitchCanvas {
    position: fixed; top: 0; left: 0;
    width: 100vw; height: 100vh; z-index: 0;
  }
  #glitchCanvas {
    pointer-events: none;
  }
  #terminal, #input-line, #uploadImageContainer {
    position: relative; z-index: 1;
  }
  #terminal { white-space: pre-wrap; padding: 20px; font-size: 28px; text-shadow: 0 0 5px rgb(178, 178, 178), 0 0 10px rgb(178, 178, 178); }
  #input-line { display: flex; margin-top: 30px; font-size: 28px; padding: 0 20px;  text-shadow: 0 0 5px rgb(178, 178, 178), 0 0 10px rgb(178, 178, 178); }
  #prompt { margin-right: 5px; }
  input { background: none; border: none; color: red; font-family: monospace; outline: none; font-size: 28px; flex: 1; text-shadow: 0 0 5px rgb(178, 178, 178), 0 0 10px rgb(178, 178, 178); }
  #scare-overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background:red; color:white; text-align:center; line-height:1.2em; z-index:100; flex-direction:column; justify-content:center; align-items:center; }
  #chip-overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background:red; color:white; text-align:center; line-height:1.2em; z-index:100; flex-direction:column; justify-content:center; align-items:center; }
  #scare-img { width:100vw; height:100vh; }
  #chip-img { width:100vw; height:100vh; }
  #uploadButton { padding:10px 20px; margin-top:10px; border:2px solid red; border-radius:10px; background:black; color:red;  text-shadow: 0 0 5px rgb(255, 255, 255), 0 0 10px rgb(255, 255, 255); }
  #fileInput { border:2px solid red; border-radius:10px; padding:10px; background:black; color:red; }
  #uploadImageContainer { margin-top:200px; text-align:center; }
</style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>
<canvas id="glitchCanvas"></canvas>

<div id="terminal" style="font-size: 28px">
  <span style="font-size: 35px">
    √údv√∂z√∂llek a K√≠s√©rtetj√°rta Konzolban! üéÉ<br>
    (A jobb √©lm√©ny√©rt hangos√≠tsd fel a k√©sz√ºl√©ked)<br>
    √çrd be: 'help' a parancsok√©rt.
  </span>
</div>

<div id="input-line">
  <span id="prompt">> </span>
  <input type="text" id="command-input" autofocus autocomplete="off" />
</div>

<div id="scare-overlay">
  <img id="scare-img" src="scary_image.jpg" alt="Scary face" />
</div>

<div id="chip-overlay">
  <img id="chip-img" src="chip_image.jpg" alt="Chip image" />
</div>

<div id="uploadImageContainer">
  <input type="file" id="fileInput" accept="image/*"><br><br>
  <button id="uploadButton" onclick="uploadImage()">Felt√∂lt√©s</button>
  <p id="status"></p>
</div>

<script>
  // ===== MATRIX H√ÅTT√âR =====
  const canvas = document.getElementById("matrixCanvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const chars = "NOTFOUNDERROR404";
  const fontSize = 16;
  const columns = Math.floor(canvas.width / fontSize);
  const drops = Array(columns).fill(1);

  function drawMatrix() {
    ctx.fillStyle = "rgba(0,0,0,0.08)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    // ctx.fillStyle = "red"; // z√∂ld m√°trix
    ctx.fillStyle = "red";
    ctx.font = fontSize + "px monospace";
    for(let i=0;i<drops.length;i++){
      const text = chars[Math.floor(Math.random()*chars.length)];
      ctx.fillText(text,i*fontSize,drops[i]*fontSize);
      if(drops[i]*fontSize > canvas.height && Math.random() > 0.975) drops[i]=0;
      drops[i]++;
    }
  }
  setInterval(drawMatrix, 35);
  window.addEventListener("resize", () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });

  // ===== GLITCH VILLAN√ÅS =====
  const glitchCanvas = document.getElementById("glitchCanvas");
  const gCtx = glitchCanvas.getContext("2d");
  glitchCanvas.width = window.innerWidth;
  glitchCanvas.height = window.innerHeight;
  function drawGlitch() {
    gCtx.clearRect(0,0,glitchCanvas.width,glitchCanvas.height);
    if(Math.random() < 0.02){ // ~2% es√©llyel villan
      gCtx.fillStyle = Math.random()<0.5 ? "white":"red";
      gCtx.globalAlpha = 0.3 + Math.random()*0.5;
      gCtx.fillRect(0,0,glitchCanvas.width,glitchCanvas.height);
      gCtx.globalAlpha=1;
    }
  }
  setInterval(drawGlitch, 100);

  // ===== TERMIN√ÅL REZG√âS / GLITCH SZ√ñVEG =====
  // function terminalBlink() {
  //   const maxSkew = 0.2; // radi√°nban a maximum ferdes√©g
  //   const skewX = (Math.random() * maxSkew*2 - maxSkew).toFixed(2);
  //   terminal.style.transform = `skewX(${skewX}rad)`;
  //   terminal.style.visibility = 'hidden';
  //   setTimeout(() => { terminal.style.visibility = 'visible'; }, Math.random()*100);
    
  //   // r√∂vid ideig legyen csak
  //   setTimeout(() => {
  //     terminal.style.transform = '';
  //     input.style.transform = '';
  //   }, 100 + Math.random()*100);
  // }

  function terminalUltraGlitch() {
    const maxSkew = 0.2;
    const skewX = (Math.random() * maxSkew*2 - maxSkew).toFixed(2);

    // Skew + random translate for 0.5 seconds
    terminal.style.transition = 'transform 0.001s';
    terminal.style.transform = `skewX(${skewX}rad)`;
    input.style.transform = `skewX(${skewX}rad)`;
    new Promise(resolve => setTimeout(resolve, 500)).then(() => {
      terminal.style.transform = `skewX(${0}rad)`;
      input.style.transform = `skewX(${0}rad)`;
    });

    // Blink effect
    terminal.style.visibility = 'hidden';
    setTimeout(() => { terminal.style.visibility = 'visible'; }, Math.random()*100);

    // Extra glitchCanvas villan√°s
    if(Math.random() < 0.2){
      gCtx.fillStyle = Math.random() < 0.5 ? "white" : "red";
      gCtx.globalAlpha = 0.3 + Math.random()*0.5;
      gCtx.fillRect(0,0,glitchCanvas.width,glitchCanvas.height);
      gCtx.globalAlpha = 1;
    }
  }

  // trigger glitch/villan√°s random id≈ëk√∂z√∂nk√©nt
  setInterval(() => {
    if(Math.random() < 0.5){ // 30% es√©ly egy ciklusban
      // terminalBlink();
      terminalUltraGlitch();
    }
  }, 2000);


  // ===== TERMIN√ÅL LOGIKA =====
  const terminal = document.getElementById("terminal");
  const input = document.getElementById("command-input");
  const scareOverlay = document.getElementById("scare-overlay");
  const chipOverlay = document.getElementById("chip-overlay");
  const scream = new Audio("scary_sound.mp3");
  const uploadContainer = document.getElementById("uploadImageContainer");
  const fileInput = document.getElementById("fileInput");
  const status = document.getElementById("status");
  uploadContainer.style.display = "none";

  const responses = {
    help:"Parancsok: \n- scan, \n- trick, \n- halloween, \n- chip (ha szeretn√©l chippendale szettben l√°tni)",
    scan:"Jelmez beolvas√°sa... HIBA: M√°rton jelmeze nem tal√°lhat√≥...",
    trick:"Tr√ºkk kiv√°lasztva! K√©sz√ºlj a meglepet√©sekre!",
    halloween:"Boldog halloween-t! T√∂lts fel egy k√©pet, hogy legyen egy csod√°s eml√©k(√ºnk)! üéÉ",
    chip: " "
  };

  function triggerScare() {
      scareOverlay.style.display = "flex";
      scream.currentTime=0;
      scream.play();
      setTimeout(()=>{scareOverlay.style.display="none";},3000);
  }

  function triggerChip(){
      chipOverlay.style.display = "flex";
      scream.currentTime=0;
      setTimeout(()=>{chipOverlay.style.display="none";},6000);
  }

  input.addEventListener("keydown", function(e){
    if(e.key==="Enter"){
      const cmd = input.value.toLowerCase();
      terminal.innerHTML += "\n> "+input.value;
      if(cmd==="trick") new Promise(r=>setTimeout(r,1200)).then(triggerScare);
      if(cmd==="chip") triggerChip();
      if(cmd==="halloween") uploadContainer.style.display="block"; 
      else { uploadContainer.style.display="none"; fileInput.value=""; status.innerText=""; }
      terminal.innerHTML += "\n"+(responses[cmd]||"Command not recognized. Try 'help'.");
      input.value="";
      terminal.scrollTop=terminal.scrollHeight;
    }
  });

  async function uploadImage() {
    const file = fileInput.files[0];
    if(!file){ status.innerText="V√°lassz ki egy k√©pet el≈ësz√∂r!"; return; }
    status.innerText="Felt√∂lt√©s folyamatban...";
    const webhookUrl="https://discord.com/api/webhooks/1432287149054627942/dqgnjoiplCQqi7gb9YMolNiKywi4CzG7V07tJ1e8UC1nlH0LIxvAwhvcOkz0pfWLGgPU";
    const formData=new FormData();
    formData.append("file",file);
    formData.append("content",`√öj k√©p √©rkezett a Haunted oldalr√≥l! üëª (${file.name})`);
    try {
      const response = await fetch(webhookUrl,{method:"POST",body:formData});
      status.innerText=response.ok?"‚úÖ Felt√∂ltve a szellemekhez!":"‚ö†Ô∏è Hiba t√∂rt√©nt a felt√∂lt√©sn√©l.";
    } catch(e){
      status.innerText="üíÄ Nem siker√ºlt kapcsol√≥dni a t√∫lvil√°ghoz...";
      console.error(e);
    }
  }
</script>
</body>
</html>
